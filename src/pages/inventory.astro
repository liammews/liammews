---
import Layout from "../layouts/layout.astro";
import { loadQuery } from "../sanity/lib/load-query";
import InventoryCard from "../components/ArchiveCards/InventoryCard/index.astro";
import Button from "../components/Button/index.astro";
import { Icon } from "astro-icon/components";
import Modal from "../components/Modal/index.astro";

// GROQ query to fetch all inventory items with category data
const INVENTORY_QUERY = `*[_type == "inventoryItem"] | order(_createdAt desc) {
  _id,
  name,
  description,
  image {
    asset->{
      _id,
      url
    },
    alt
  },
  link,
  datePurchased,
  wishlist,
  category->{
    _id,
    title,
    image {
      asset->{
        _id,
        url
      },
      alt
    }
  }
}`;

const { data: inventoryItems } = await loadQuery({
  query: INVENTORY_QUERY,
});
---

<Layout 
  title="Inventory"
  image="/favicon.svg"
>
<div slot="nav">
  <Button ariaLabel="What is this?" modalId="inventory" action="open" tooltip="âŒ˜I">
    <Icon name="info" />
  </Button>
</div>

  <main>
    <Modal id="inventory" keyboardShortcut="i">
      <div slot="title">What is this?</div>
      <div class="rich-text modal_body-content">
        <p>A page to collate and share my favourite essential. I like to think of myself as an essentialist, I try to keep my list of belongings pretty small but invest in high-quality things that will serve me well for many years.</p>
        <p>This list isn't everything I own/use, but things I would buy again in a heartbeat.</p>
      </div>
    </Modal>

    <div class="grid intro-in">
      {(inventoryItems as any[]).map((item: any) => (
        <InventoryCard title={item.name} image={item.image.asset.url} link={item.link} description={item.description} category={item.category.title} />
      ))}
    </div>
  </main>
</Layout>

<style>
  .inventory-item_image-container {
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    transition: transform 0.3s ease-in-out;
  }

  .inventory_image {
    width: 80%;
    aspect-ratio: 1 / 1;
    object-fit: contain;
  }

  .inventory_image.is-app {
    width: 70%;
    max-width: 6.5rem !important;
  }
  
</style>
